<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>user_profile page</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css" />
    <style>
        a {
            color: white;
            background-color: transparent;
            text-decoration: none;
        }

        .container {
            margin-left: 10px;
            margin-bottom: 10px;
        }

        .btn {
            font-size: 12px;
        }

        .col-form-label {
            margin: 2%;
        }

        .form-control {
            margin: 2%;
        }

        .error {
            color: red;
        }
    </style>
</head>

<body>
    <navbar> </navbar>
    <div class="row" style="
        margin: 5px;
        height: 25%;
        background-color: rgb(0, 75, 135);
        color: white;
      ">
        <div class="col col-md-11 col-sm-11">welcome <%= result.first_name %>
        </div>
        <div class="col col-md-1 col-sm-1">
            <a href="/account">Log out</a>
        </div>
    </div>
    <div class="row">
        <div class="col col-md-3">
            <div class="container" style="border: 2px solid black; text-align: center">
                <% let sometime=result;sometime.new="adding" %>
                <% const params=new URLSearchParams(sometime).toString(); %>

                    <!-- // Encode the data as a URL query string -->
                    <a href="/user_profile/myprofile/?<%=params %>">

                        <div>
                            <i class="bi bi-person-fill" style="font-size: 4rem; color:black;"></i>
                        </div>
                        <div>
                            <button type="button" class="btn" style="background-color: rgb(10, 131, 195); color: white">
                                MY PROFILE
                            </button>
                        </div>
                    </a>
            </div>
            <div class="container" style="border: 2px solid black; text-align: center">
                <a href="/user_profile/change_password/?<%= params %>">

                    <div>
                        <i class="bi bi-lock" style="font-size: 4rem; color:black;"></i>
                    </div>
                    <div>
                        <button type="button" class="btn" style="background-color: rgb(10, 131, 195); color: white">
                            CHANGE PASSWORD
                        </button>
                    </div>
                </a>
            </div>

            <div class="container" style="border: 2px solid black; text-align: center">
                <a href="/user_profile/buy_ticket/?<%=params %>">

                    <div>
                        <i class="bi bi-ticket-detailed" style="font-size: 4rem; color:black;"></i>
                    </div>
                    <div>
                        <button type="button" class="btn" style="background-color: rgb(10, 131, 195); color: white">
                            BUY TICKET
                        </button>
                    </div>
                </a>
            </div>
            <div class="container" style="border: 2px solid black; text-align: center">
                <a href="/user_profile/transactions/?<%=params %>">

                    <div>
                        <i class="bi bi-card-checklist" style="font-size: 4rem ;color:black;"></i>
                    </div>
                    <div>
                        <button type="button" class="btn" style="background-color: rgb(10, 131, 195); color: white">
                            Transaction History
                        </button>
                    </div>
                </a>
            </div>
        </div>
        <div class="col-md-9 col  col-sm-12">
            <!-- <img style="width : 98%; height : 97%; margin-right:10px;" src="/css/hyderabad_metro.gif"> -->
            <div class="container" style=" border:2px solid black; width:95%; padding:0px">
                <div style="background-color: rgb(10, 131, 195);
    color: white; height:10%;"> Change Password
                </div>
                <form id="change_pass">
                    <div class="form-group row">

                        <label for="inputPassword" class="col-md-3 col-form-label">Old/Existing Password <span
                                style="color:red;">*</span></label>
                        <div class="col-md-6 col-sm-12">
                            <input type="password" class="form-control" id="inputPassword" placeholder="old password "
                                name="old_password">
                            <div class="error"></div>
                        </div>
                    </div>

                    <div class="form-group row">

                        <label for="inputPassword2" class="col-md-3 col-form-label">New Password<span
                                style="color:red;">*</span></label>
                        <div class="col-md-6 col-sm-12">
                            <input type="password" class="form-control" id="inputPassword2" placeholder="New Password"
                                name="new_password">
                            <div class="error"></div>

                            <span style="font-size:11px; margin:5px; padding:0px;">
                                Enter at least 8 character including alphabets, numerals and special character
                            </span>
                        </div>
                    </div>
                    <div class="form-group row">

                        <label for="inputPassword3" class="col-md-3 col-form-label">Confirm Password<span
                                style="color:red;">*</span></label>
                        <div class="col-md-6 col-sm-12">
                            <input type="password" class="form-control" id="inputPassword3"
                                placeholder="confirm password" name="re_password">
                            <div class="error"></div>

                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-md-3"></div>
                        <div class="col-md-2" style="margin-left:5%;">
                            <input type="submit" class="form-control"
                                style="background-color: rgb(7,131,195); color:white;" id="submit_password"
                                value="submit" name="button">
                        </div>
                    </div>

                </form>
            </div>
            <img style="width : 95%; height : 50%; margin:10px;" src="/css/hyderabad_metro.gif">
        </div>
    </div>
    </div>
    <!--[if lt IE 7]>
      <p class="browsehappy">
        You are using an <strong>outdated</strong> browser. Please
        <a href="#">upgrade your browser</a> to improve your experience.
      </p>
    <![endif]-->
<% let something=result %>
    <script>
        const forgot_form = document.getElementById("change_pass");
        const old_password = document.getElementById("inputPassword");
        const new_password = document.getElementById("inputPassword2");
        const re_password = document.getElementById("inputPassword3");
        //ekkada elane error chupistundi kani error emi ledhu
        let something= <%- JSON.stringify(something) %>;
        forgot_form.addEventListener("submit", (e) => {
            e.preventDefault();
            validateInputs();
        });
        const validateInputs = () => {
            const old_value = old_password.value.trim();
            const new_pass = new_password.value.trim();
            const re_pass = re_password.value.trim();
           
            if (old_value != something.password) {
                SetError(old_password, "Wrong Old Password");
                return;
            }
            else if (new_pass.length < 8) {
                SetError(new_password, "");
                return;
            }
            else if (new_pass != re_pass) {
                SetError(re_password, "password mismatched");

                return;
            }
            else {
                const data = {
                    email: something.email,
                    first_name: something.first_name,
                    last_name:something.last_name,
                    mobile_number:something.mobile_number,
                    old_password: old_value,
                    new_password: new_pass
                };

                // Encode the data as a URL query string
                const params = new URLSearchParams(data).toString();
               window.location.assign(`/user_profile/save_new_password/?${params}`);

            }
        }

        const SetError = (element, message) => {
            const inputControl = element.parentElement;
            const errorDisplay = inputControl.querySelector(".error");

            errorDisplay.innerText = message;
            inputControl.classList.add("error");
        };


    </script>
</body>

</html>